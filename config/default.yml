data:
  manifest_train: manifests/train.csv
  manifest_val:   manifests/val.csv
  manifest_test:  manifests/test.csv

  image_col: image_path
  presence_col: presence
  cx_col: cx
  cy_col: cy

  use_pre_letterboxed: true
  letterbox_meta_csv: letterbox_meta.csv  # prodotto dallo script
  letterbox_size_assert: 384   # per sicurezza: deve coincidere con out_size nel CSV

train:
  image_size: 384
  batch_size: 64   # per GPU; global = batch_size * world_size
  num_workers: 0
  dataloader_timeout_s: 60   # >0 per evitare deadlock: solleva eccezione se il dataloader si blocca
  persistent_workers: true   # disattiva (false) se sospetti deadlock dei worker tra le epoche
  epochs: 50
  lr: 5.0e-4
  weight_decay: 1.0e-5
  amp: true
  scale_lr_by_world_size: true
  seed: 493
  save_dir: checkpoints
  val_every: 2
  best_ckpt_start_epoch: 5
  backbone: resnet18        # resnet18|resnet50|x3d_xs|x3d_s
  backbone_pretrained: true # usa pesi pre-addestrati per il backbone
  heatmap_stride: 4         # output 128x128 quando input 512
  use_aug: false            # puoi mettere true se serve
  temporal_T: 5             # numero di frame temporali (early fusion canali)
  temporal_stride: 6        # salto tra frame temporali (>=1)
  presence_dropout: 0.2     # dropout tra GAP e FC della testa presenza

loss:
  heatmap_sigma_px: 8
  w_heatmap: 1.0
  w_presence: 10.0
  heatmap_neg_multiplier: 0.2   # fattore di peso per la heatmap dei negativi (0=ignora, 1=pari ai positivi)
  presence_loss: focal       # focal|bce (per la testa presenza)
  presence_focal_gamma: 1.5
  presence_focal_alpha: 0.75
  auto_balance: false          # bilancia automaticamente le magnitudini di heatmap e presence
  auto_balance_clip: [0.1, 100.0]
  presence_label_smoothing: 0.03

infer:
  batch_size: 128
  presence_threshold: 0.5
  topk_peaks: 1
  roi_base_radius_px: 112    # met√† tile 224
  roi_sigma_multiplier: 2.5
  out_dir: outputs/preds
